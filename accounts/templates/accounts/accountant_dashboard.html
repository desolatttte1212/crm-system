<!-- templates/accounts/accountant.html -->
{% extends "accounts/base_dashboard.html" %}
{% block title %}–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è{% endblock %}
{% block header %}–ë—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è{% endblock %}
{% block content %}
<div class="card">
    <!-- –í–∫–ª–∞–¥–∫–∏ -->
    <div style="display: flex; border-bottom: 1px solid var(--border); margin-bottom: 1.5rem;">
        <div class="tab" style="padding: 0.75rem 1.5rem; cursor: pointer; font-weight: 500; color: var(--text-muted); border-bottom: 3px solid transparent;" onclick="showTab('invoices')">
            üßæ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å—á—ë—Ç–æ–≤
        </div>
        <div class="tab" style="padding: 0.75rem 1.5rem; cursor: pointer; font-weight: 500; color: var(--text-muted); border-bottom: 3px solid transparent;" onclick="showTab('shipping')">
            üì¶ –û—Ç–≥—Ä—É–∑–æ—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
        </div>
        <div class="tab" style="padding: 0.75rem 1.5rem; cursor: pointer; font-weight: 500; color: var(--text-muted); border-bottom: 3px solid transparent;" onclick="showTab('payment')">
            üíµ –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã
        </div>
    </div>

    <!-- –°–µ–∫—Ü–∏—è: –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ —Å—á—ë—Ç–æ–≤ -->
    <div id="invoices-section" class="accountant-section">
        <p style="color: var(--text-muted); margin: 1rem 0;">–ó–∞—è–≤–∫–∏, —Ç—Ä–µ–±—É—é—â–∏–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è —Å—á—ë—Ç–∞</p>

        {% if invoice_requests %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid var(--border);">
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">ID</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–ö–ª–∏–µ–Ω—Ç</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–¢–æ–≤–∞—Ä</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–î–µ–π—Å—Ç–≤–∏–µ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for req in invoice_requests %}
                            <tr style="border-bottom: 1px solid var(--border);">
                                <td style="padding: 1rem; color: var(--text);">{{ req.id }}</td>
                                <td style="padding: 1rem; color: var(--text);">{{ req.user.username }}</td>
                                <td style="padding: 1rem; color: var(--text);">{{ req.product_name }}</td>
                                <td style="padding: 1rem; color: var(--text);">{{ req.cost_estimate }} ‚ÇΩ</td>
                                <td style="padding: 1rem;">
                                    <form method="post" action="{% url 'accountant_create_invoice' req.id %}" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <input type="file" name="invoice_file" required style="margin-bottom: 0.5rem;">
                                        <button type="submit" class="btn btn-primary">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å —Å—á—ë—Ç</button>
                                    </form>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="5" style="padding: 2rem; text-align: center; color: var(--text-muted);">
                                    –ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ —Å—á—ë—Ç–∞
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p style="text-align: center; color: var(--text-muted); padding: 1rem;">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ —Å—á—ë—Ç–∞</p>
        {% endif %}
    </div>

    <!-- –°–µ–∫—Ü–∏—è: –û—Ç–≥—Ä—É–∑–æ—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã -->
    <div id="shipping-section" class="accountant-section" style="display: none;">
        <p style="color: var(--text-muted); margin: 1rem 0;">–ó–∞—è–≤–∫–∏, –≥–æ—Ç–æ–≤—ã–µ –∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—é –æ—Ç–≥—Ä—É–∑–æ—á–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤</p>

        {% if shipping_requests %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid var(--border);">
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">ID</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–ö–ª–∏–µ–Ω—Ç</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–¢–æ–≤–∞—Ä</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–î–µ–π—Å—Ç–≤–∏–µ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for req in shipping_requests %}
                            <tr style="border-bottom: 1px solid var(--border);">
                                <td style="padding: 1rem; color: var(--text);">{{ req.id }}</td>
                                <td style="padding: 1rem; color: var(--text);">{{ req.user.username }}</td>
                                <td style="padding: 1rem; color: var(--text);">{{ req.product_name }}</td>
                                <td style="padding: 1rem;">
                                    <form method="post" action="{% url 'accountant_add_shipping_docs' req.id %}" enctype="multipart/form-data">
                                        {% csrf_token %}
                                        <input type="file" name="shipping_docs" required style="margin-bottom: 0.5rem;">
                                        <button type="submit" class="btn btn-primary">–ü—Ä–∏–∫—Ä–µ–ø–∏—Ç—å –æ—Ç–≥—Ä—É–∑–æ—á–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã</button>
                                    </form>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="4" style="padding: 2rem; text-align: center; color: var(--text-muted);">
                                    –ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –æ—Ç–≥—Ä—É–∑–∫–∏
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p style="text-align: center; color: var(--text-muted); padding: 1rem;">–ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–∏ –æ—Ç–≥—Ä—É–∑–∫–∏</p>
        {% endif %}
    </div>

    <!-- –°–µ–∫—Ü–∏—è: –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã -->
    <div id="payment-section" class="accountant-section" style="display: none;">
        <p style="color: var(--text-muted); margin: 1rem 0;">–ó–∞—è–≤–∫–∏, –æ–∂–∏–¥–∞—é—â–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã</p>

        {% if payment_requests %}
            <div style="overflow-x: auto;">
                <table style="width: 100%; border-collapse: collapse; margin-top: 1rem;">
                    <thead>
                        <tr style="border-bottom: 2px solid var(--border);">
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">ID</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–ö–ª–∏–µ–Ω—Ç</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–¢–æ–≤–∞—Ä</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–°—É–º–º–∞</th>
                            <th style="padding: 1rem; text-align: left; color: var(--primary-light);">–î–µ–π—Å—Ç–≤–∏–µ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for req in payment_requests %}
                            <tr style="border-bottom: 1px solid var(--border);">
                                <td style="padding: 1rem; color: var(--text);">{{ req.id }}</td>
                                <td style="padding: 1rem; color: var(--text);">{{ req.user.username }}</td>
                                <td style="padding: 1rem; color: var(--text);">{{ req.product_name }}</td>
                                <td style="padding: 1rem; color: var(--text);">{{ req.cost_estimate }} ‚ÇΩ</td>
                                <td style="padding: 1rem;">
                                    <form method="post" action="{% url 'confirm_payment' req.id %}">
                                        {% csrf_token %}
                                        <button type="submit" class="btn btn-primary">
                                            ‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        {% empty %}
                            <tr>
                                <td colspan="5" style="padding: 2rem; text-align: center; color: var(--text-muted);">
                                    –ù–µ—Ç –∑–∞—è–≤–æ–∫ –Ω–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –æ–ø–ª–∞—Ç—ã
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        {% else %}
            <p style="text-align: center; color: var(--text-muted); padding: 1rem;">–ù–µ—Ç –∑–∞—è–≤–æ–∫</p>
        {% endif %}
    </div>
</div>

<!-- JavaScript –¥–ª—è –≤–∫–ª–∞–¥–æ–∫ -->
<script>
    function showTab(tabName) {
        // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
        document.getElementById('invoices-section').style.display = 'none';
        document.getElementById('shipping-section').style.display = 'none';
        document.getElementById('payment-section').style.display = 'none';

        // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É —É –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
        document.querySelectorAll('.tab').forEach(tab => {
            tab.style.color = 'var(--text-muted)';
            tab.style.borderBottom = '3px solid transparent';
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
        if (tabName === 'invoices') {
            document.getElementById('invoices-section').style.display = 'block';
            document.querySelector('.tab:nth-child(1)').style.color = 'var(--primary-light)';
            document.querySelector('.tab:nth-child(1)').style.borderBottom = '3px solid var(--primary-light)';
        } else if (tabName === 'shipping') {
            document.getElementById('shipping-section').style.display = 'block';
            document.querySelector('.tab:nth-child(2)').style.color = 'var(--primary-light)';
            document.querySelector('.tab:nth-child(2)').style.borderBottom = '3px solid var(--primary-light)';
        } else if (tabName === 'payment') {
            document.getElementById('payment-section').style.display = 'block';
            document.querySelector('.tab:nth-child(3)').style.color = 'var(--primary-light)';
            document.querySelector('.tab:nth-child(3)').style.borderBottom = '3px solid var(--primary-light)';
        }
    }

    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∫–ª–∞–¥–∫—É "—Å—á—ë—Ç–∞"
    showTab('invoices');
</script>

<style>
    .accountant-section {
        transition: opacity 0.3s ease;
    }
</style>
{% endblock %}